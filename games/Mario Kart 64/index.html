<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mario Kart 64</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Mario Kart 64</h1>

    <!-- Canvas for game -->
    <canvas id="gameCanvas" width="640" height="480"></canvas>

    <!-- Status -->
    <p id="status">Loading...</p>

    <!-- Controls -->
    <div class="controls">
      <input type="file" id="romInput" accept=".z64,.n64">
      <button id="startBtn">Start Game</button>
      <button id="pauseBtn">Pause Game</button>
    </div>

    <!-- Keyboard hints -->
    <div class="hints">
      <p>Arrow keys = Steering, Z = Accelerate, X = Brake</p>
      <p>Gamepad supported if connected</p>
    </div>
  </div>

  <script type="module">
    import init from './MK64.js';

    const canvas = document.getElementById('gameCanvas');
    const status = document.getElementById('status');
    const romInput = document.getElementById('romInput');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    let ModuleInstance = null;
    let romData = null;

    // Load the WASM module
    async function loadWASM() {
      status.textContent = "Loading MK64 WebAssembly...";
      ModuleInstance = await init();
      ModuleInstance.canvas = canvas;
      status.textContent = "MK64 WebAssembly loaded!";
    }

    // Load ROM from file input
    romInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function() {
          romData = new Uint8Array(this.result);
          status.textContent = `ROM loaded: ${file.name}`;
        };
        reader.readAsArrayBuffer(file);
      }
    });

    // Start button
    startBtn.addEventListener('click', () => {
      if (!ModuleInstance || !romData) {
        status.textContent = "Load WASM and ROM first!";
        return;
      }
      status.textContent = "Starting game...";
      ModuleInstance.loadROM(romData);
      ModuleInstance.run();
    });

    // Pause button (if supported by your loader)
    pauseBtn.addEventListener('click', () => {
      if (ModuleInstance && ModuleInstance.pause) {
        ModuleInstance.pause();
        status.textContent = "Game paused.";
      }
    });

    // Initialize
    loadWASM();
  </script>
</body>
</html>
